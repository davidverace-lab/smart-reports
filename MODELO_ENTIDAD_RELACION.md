# MODELO ENTIDAD-RELACIรN DEFINITIVO
## Sistema Smart Reports - Instituto Hutchison Ports

---

## RESUMEN EJECUTIVO

Este documento presenta el modelo de base de datos completo y definitivo para el sistema Smart Reports del Instituto Hutchison Ports. El modelo incluye todas las entidades necesarias para:

- โ Gestiรณn de usuarios y capacitaciones (IMPLEMENTADO)
- โ Seguimiento de progreso de mรณdulos (IMPLEMENTADO)
- โ Organizaciรณn por unidades de negocio (IMPLEMENTADO)
- ๐ Sistema TNG (Terminal de Nuevas Generaciones) - **NUEVO**
- ๐ Gestiรณn de roles y permisos - **NUEVO**
- ๐ Auditorรญa y trazabilidad - **NUEVO**
- ๐ Sistema de reportes gerenciales - **NUEVO**

---

## DIAGRAMA ENTIDAD-RELACIรN (Texto)

```
โโโโโโโโโโโโโโโโโโโโโโโ       โโโโโโโโโโโโโโโโโโโโโโโ
โ   Rol               โ       โ   Usuario           โ
โ                     โ       โ                     โ
โ * IdRol PK          โโโโโ   โ * UserId PK         โ
โ   NombreRol         โ   โ   โ   Nombre            โ
โ   Descripcion       โ   โ   โ   Email             โ
โ   Activo            โ   โ   โ   TipoDeCorreo      โ
โโโโโโโโโโโโโโโโโโโโโโโ   โ   โ   IdUnidadDeNegocio FKโ
                          โ   โ   IdRol FK          โ
                          โ   โ   Division          โ
                          โ   โ   Nivel             โ
                          โ   โ   Activo            โ
                          โ   โ   FechaCreacion     โ
                          โ   โ   UltimaConexion    โ
                          โ   โโโโโโโโโโโโโโโโโโโโโโโ
                          โ            โ
                          โโโโโโโโโโโโโโ            โ
                                                    โ
โโโโโโโโโโโโโโโโโโโโโโโ                            โ
โ UnidadDeNegocio     โ                            โ
โ                     โ                            โ
โ * IdUnidadDeNegocioโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ   NombreUnidad      โ
โ   Descripcion       โ
โ   IdDepartamento FK โ
โ   Activo            โ
โโโโโโโโโโโโโโโโโโโโโโโ
         โ
         โ
         โผ
โโโโโโโโโโโโโโโโโโโโโโโ       โโโโโโโโโโโโโโโโโโโโโโโ
โ Departamento        โ       โ   Modulo            โ
โ                     โ       โ                     โ
โ * IdDepartamento PK โ       โ * IdModulo PK       โ
โ   NombreDepartamentoโ       โ   NombreModulo      โ
โ   TipoDepartamento  โ       โ   Descripcion       โ
โ   Activo            โ       โ   Duracion          โ
โโโโโโโโโโโโโโโโโโโโโโโ       โ   FechaDeAsignacion โ
                              โ   Activo            โ
                              โ   EsCritico         โ
                              โโโโโโโโโโโโโโโโโโโโโโโ
                                       โ
                                       โ
         โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโผโโโโโโโโโโโโโโโโโโโโโโโ
         โ                             โ                       โ
         โผ                             โผ                       โผ
โโโโโโโโโโโโโโโโโโโโโโโ       โโโโโโโโโโโโโโโโโโโโโโโ โโโโโโโโโโโโโโโโโโโโ
โ ProgresoModulo      โ       โ ModuloDepartamento  โ โ Evaluacion       โ
โ                     โ       โ                     โ โ                  โ
โ* IdInscripcion PK   โ       โ* IdModuloDept PK    โ โ* IdEvaluacion PK โ
โ  UserId FK          โ       โ  IdModulo FK        โ โ  IdModulo FK     โ
โ  IdModulo FK        โ       โ  IdDepartamento FK  โ โ  TipoEvaluacion  โ
โ  EstatusModuloUsu   โ       โ  Obligatorio        โ โ  PuntajeMinimo   โ
โ  CalificacionModulo โ       โ  FechaAsignacion    โ โ  Activo          โ
โ  FechaInicio        โ       โโโโโโโโโโโโโโโโโโโโโโโ โโโโโโโโโโโโโโโโโโโโ
โ  FechaFinalizacion  โ                                                   โ
โ  FechaUltimaAct     โ                                                   โ
โ  IntentosRealizados โ                                                   โ
โโโโโโโโโโโโโโโโโโโโโโโ                                                   โ
         โ                                                                โ
         โ                                                                โ
         โโโโโโโโโโโโโโโโโโโโโโ                                          โ
                              โผ                                          โผ
                     โโโโโโโโโโโโโโโโโโโโโโโ               โโโโโโโโโโโโโโโโโโโโโโโโ
                     โ HistorialProgreso   โ               โ ResultadoEvaluacion  โ
                     โ                     โ               โ                      โ
                     โ* IdHistorial PK     โ               โ* IdResultado PK      โ
                     โ  IdInscripcion FK   โ               โ  IdEvaluacion FK     โ
                     โ  EstatusAnterior    โ               โ  UserId FK           โ
                     โ  EstatusNuevo       โ               โ  Puntaje             โ
                     โ  FechaCambio        โ               โ  Aprobado            โ
                     โ  UsuarioSistema     โ               โ  FechaRealizacion    โ
                     โ  Comentarios        โ               โ  Intentos            โ
                     โโโโโโโโโโโโโโโโโโโโโโโ               โโโโโโโโโโโโโโโโโโโโโโโโ


โโโโโโโโโโโโโโโโโโโโโโโ       โโโโโโโโโโโโโโโโโโโโโโโ
โ ReporteGerencial    โ       โ AuditoriaAcceso     โ
โ                     โ       โ                     โ
โ* IdReporte PK       โ       โ* IdAuditoria PK     โ
โ  TipoReporte        โ       โ  UserId FK          โ
โ  NombreReporte      โ       โ  Accion             โ
โ  UsuarioGenerador   โ       โ  Modulo             โ
โ  FechaGeneracion    โ       โ  DireccionIP        โ
โ  FechaInicio        โ       โ  FechaHora          โ
โ  FechaFin           โ       โ  Exito              โ
โ  Parametros         โ       โ  DetallesAdicionalesโ
โ  ArchivoPDF         โ       โโโโโโโโโโโโโโโโโโโโโโโ
โโโโโโโโโโโโโโโโโโโโโโโ
```

---

## ENTIDADES Y ATRIBUTOS DETALLADOS

### 1. **Instituto_Usuario** (EXISTENTE - MEJORADA)

**Descripciรณn:** Almacena informaciรณn de todos los usuarios del Instituto HP.

| Atributo | Tipo | Restricciรณn | Descripciรณn |
|----------|------|-------------|-------------|
| **UserId** | VARCHAR(50) | PK, NOT NULL | Identificador รบnico del usuario (ej: U12345) |
| Nombre | VARCHAR(200) | NOT NULL | Nombre completo del usuario |
| Email | VARCHAR(150) | NOT NULL, UNIQUE | Correo electrรณnico corporativo |
| TipoDeCorreo | VARCHAR(50) | DEFAULT 'Corporativo' | Tipo de correo (Corporativo, Personal) |
| IdUnidadDeNegocio | INT | FK, NULL | Referencia a unidad de negocio |
| IdRol | INT | FK, DEFAULT 1 | Referencia a rol del usuario (1=Usuario, 2=Supervisor, etc.) |
| Division | VARCHAR(100) | NULL | Divisiรณn a la que pertenece |
| Nivel | VARCHAR(100) | NULL | Nivel/puesto del usuario |
| Activo | BIT | NOT NULL, DEFAULT 1 | Indica si el usuario estรก activo |
| FechaCreacion | DATETIME | DEFAULT GETDATE() | Fecha de creaciรณn del registro |
| UltimaConexion | DATETIME | NULL | รltima vez que el usuario accediรณ al sistema |

**รndices:**
- `PK_Usuario_UserId` (PRIMARY KEY)
- `IX_Usuario_Email` (UNIQUE)
- `IX_Usuario_UnidadNegocio` (FOREIGN KEY)
- `IX_Usuario_Activo` (para consultas de usuarios activos)

---

### 2. **Instituto_Modulo** (EXISTENTE - MEJORADA)

**Descripciรณn:** Catรกlogo de los 14 mรณdulos de capacitaciรณn del Instituto HP.

| Atributo | Tipo | Restricciรณn | Descripciรณn |
|----------|------|-------------|-------------|
| **IdModulo** | INT | PK, IDENTITY(1,1) | ID รบnico del mรณdulo (1-14) |
| NombreModulo | VARCHAR(300) | NOT NULL | Nombre corto del mรณdulo |
| Descripcion | TEXT | NULL | Descripciรณn detallada del mรณdulo |
| Duracion | INT | NULL | Duraciรณn estimada en horas |
| FechaDeAsignacion | DATETIME | DEFAULT GETDATE() | Fecha de creaciรณn/asignaciรณn |
| Activo | BIT | NOT NULL, DEFAULT 1 | Indica si el mรณdulo estรก activo |
| EsCritico | BIT | DEFAULT 0 | Marca si el mรณdulo es crรญtico |

**รndices:**
- `PK_Modulo_IdModulo` (PRIMARY KEY)
- `IX_Modulo_Activo` (para filtrar mรณdulos activos)

**Mรณdulos definidos (1-14):**
1. Filosofรญa HP
2. Sostenibilidad
3. Operaciones
4. Relaciones Laborales
5. Seguridad
6. Ciberseguridad
7. Entorno Laboral
8. RRHH
9. Bienestar
10. Nuevos Productos
11. Productos Digitales
12. Tecnologรญa
13. Contingencia
14. Calidad

---

### 3. **Instituto_ProgresoModulo** (EXISTENTE - MEJORADA)

**Descripciรณn:** Registra el progreso de cada usuario en cada mรณdulo.

| Atributo | Tipo | Restricciรณn | Descripciรณn |
|----------|------|-------------|-------------|
| **IdInscripcion** | INT | PK, IDENTITY(1,1) | ID รบnico de inscripciรณn |
| UserId | VARCHAR(50) | FK, NOT NULL | Referencia al usuario |
| IdModulo | INT | FK, NOT NULL | Referencia al mรณdulo |
| EstatusModuloUsuario | VARCHAR(50) | NOT NULL, DEFAULT 'Registrado' | Estado: Completado, En proceso, Registrado, No iniciado |
| CalificacionModuloUsuario | DECIMAL(5,2) | NULL, CHECK (>= 0 AND <= 100) | Calificaciรณn obtenida (0-100) |
| FechaInicio | DATE | NULL | Fecha en que iniciรณ el mรณdulo |
| FechaFinalizacion | DATETIME | NULL | Fecha y hora de finalizaciรณn |
| FechaUltimaActualizacion | DATETIME | DEFAULT GETDATE() | รltima actualizaciรณn del registro |
| IntentosRealizados | INT | DEFAULT 0 | Nรบmero de intentos realizados |

**Restricciones:**
- `UQ_ProgresoModulo_Usuario_Modulo` (UNIQUE: UserId + IdModulo)
- `CHECK_EstatusModulo` (EstatusModuloUsuario IN ('Completado', 'En proceso', 'Registrado', 'No iniciado'))

**รndices:**
- `PK_ProgresoModulo_IdInscripcion` (PRIMARY KEY)
- `IX_ProgresoModulo_UserId` (FOREIGN KEY)
- `IX_ProgresoModulo_IdModulo` (FOREIGN KEY)
- `IX_ProgresoModulo_Estatus` (para filtros por estado)
- `IX_ProgresoModulo_FechaFinalizacion` (para reportes de tendencias)

---

### 4. **Instituto_UnidadDeNegocio** (EXISTENTE - MEJORADA)

**Descripciรณn:** Unidades de negocio de Hutchison Ports.

| Atributo | Tipo | Restricciรณn | Descripciรณn |
|----------|------|-------------|-------------|
| **IdUnidadDeNegocio** | INT | PK, IDENTITY(1,1) | ID รบnico de unidad |
| NombreUnidad | VARCHAR(200) | NOT NULL, UNIQUE | Nombre de la unidad |
| Descripcion | TEXT | NULL | Descripciรณn de la unidad |
| IdDepartamento | INT | FK, NULL | Referencia al departamento TNG asociado |
| Activo | BIT | NOT NULL, DEFAULT 1 | Indica si estรก activa |

**รndices:**
- `PK_UnidadDeNegocio_IdUnidad` (PRIMARY KEY)
- `UQ_UnidadDeNegocio_Nombre` (UNIQUE)

---

### 5. **Instituto_Departamento** ๐ NUEVA

**Descripciรณn:** Departamentos TNG (Terminal de Nuevas Generaciones) para drill-down.

| Atributo | Tipo | Restricciรณn | Descripciรณn |
|----------|------|-------------|-------------|
| **IdDepartamento** | INT | PK, IDENTITY(1,1) | ID รบnico del departamento |
| NombreDepartamento | VARCHAR(200) | NOT NULL, UNIQUE | Nombre del departamento (ej: Operaciones TNG) |
| TipoDepartamento | VARCHAR(50) | DEFAULT 'TNG' | Tipo: TNG, Corporativo, etc. |
| TasaFinalizacion | DECIMAL(5,2) | NULL | Porcentaje de finalizaciรณn actual |
| Activo | BIT | NOT NULL, DEFAULT 1 | Indica si estรก activo |

**Departamentos TNG iniciales:**
1. Operaciones TNG (87%)
2. Logรญstica TNG (73%)
3. Mantenimiento TNG (92%)
4. Seguridad TNG (65%)

**รndices:**
- `PK_Departamento_IdDepartamento` (PRIMARY KEY)
- `UQ_Departamento_Nombre` (UNIQUE)

---

### 6. **Instituto_ModuloDepartamento** ๐ NUEVA

**Descripciรณn:** Relaciรณn N:M entre mรณdulos y departamentos (mรณdulos obligatorios por departamento).

| Atributo | Tipo | Restricciรณn | Descripciรณn |
|----------|------|-------------|-------------|
| **IdModuloDepartamento** | INT | PK, IDENTITY(1,1) | ID รบnico de relaciรณn |
| IdModulo | INT | FK, NOT NULL | Referencia al mรณdulo |
| IdDepartamento | INT | FK, NOT NULL | Referencia al departamento |
| Obligatorio | BIT | NOT NULL, DEFAULT 1 | Si es obligatorio para el departamento |
| FechaAsignacion | DATETIME | DEFAULT GETDATE() | Cuรกndo se asignรณ |

**Restricciones:**
- `UQ_ModuloDepartamento` (UNIQUE: IdModulo + IdDepartamento)

**รndices:**
- `PK_ModuloDepartamento_Id` (PRIMARY KEY)
- `IX_ModuloDepartamento_Modulo` (FOREIGN KEY)
- `IX_ModuloDepartamento_Departamento` (FOREIGN KEY)

---

### 7. **Instituto_Rol** ๐ NUEVA

**Descripciรณn:** Roles de usuario para control de acceso.

| Atributo | Tipo | Restricciรณn | Descripciรณn |
|----------|------|-------------|-------------|
| **IdRol** | INT | PK, IDENTITY(1,1) | ID รบnico del rol |
| NombreRol | VARCHAR(100) | NOT NULL, UNIQUE | Nombre del rol |
| Descripcion | VARCHAR(500) | NULL | Descripciรณn del rol |
| NivelAcceso | INT | DEFAULT 1 | Nivel de acceso (1=Bรกsico, 5=Admin) |
| Activo | BIT | NOT NULL, DEFAULT 1 | Indica si estรก activo |

**Roles iniciales:**
1. Usuario Estรกndar (nivel 1)
2. Supervisor (nivel 2)
3. Jefe de Departamento (nivel 3)
4. Gerente TNG (nivel 4)
5. Administrador (nivel 5)

**รndices:**
- `PK_Rol_IdRol` (PRIMARY KEY)
- `UQ_Rol_Nombre` (UNIQUE)

---

### 8. **Instituto_Evaluacion** ๐ NUEVA

**Descripciรณn:** Evaluaciones asociadas a los mรณdulos.

| Atributo | Tipo | Restricciรณn | Descripciรณn |
|----------|------|-------------|-------------|
| **IdEvaluacion** | INT | PK, IDENTITY(1,1) | ID รบnico de evaluaciรณn |
| IdModulo | INT | FK, NOT NULL | Mรณdulo al que pertenece |
| TipoEvaluacion | VARCHAR(50) | NOT NULL | Tipo: Quiz, Examen Final, Prรกctica |
| PuntajeMinimo | DECIMAL(5,2) | DEFAULT 70.00 | Puntaje mรญnimo para aprobar |
| NumeroPreguntas | INT | NULL | Nรบmero de preguntas |
| Activo | BIT | NOT NULL, DEFAULT 1 | Indica si estรก activa |

**รndices:**
- `PK_Evaluacion_IdEvaluacion` (PRIMARY KEY)
- `IX_Evaluacion_IdModulo` (FOREIGN KEY)

---

### 9. **Instituto_ResultadoEvaluacion** ๐ NUEVA

**Descripciรณn:** Resultados de evaluaciones realizadas por usuarios.

| Atributo | Tipo | Restricciรณn | Descripciรณn |
|----------|------|-------------|-------------|
| **IdResultado** | INT | PK, IDENTITY(1,1) | ID รบnico del resultado |
| IdEvaluacion | INT | FK, NOT NULL | Referencia a evaluaciรณn |
| UserId | VARCHAR(50) | FK, NOT NULL | Referencia al usuario |
| Puntaje | DECIMAL(5,2) | NOT NULL, CHECK (>= 0 AND <= 100) | Puntaje obtenido |
| Aprobado | BIT | NOT NULL | Si aprobรณ o no |
| FechaRealizacion | DATETIME | DEFAULT GETDATE() | Cuรกndo realizรณ la evaluaciรณn |
| NumeroIntento | INT | DEFAULT 1 | Nรบmero de intento |

**รndices:**
- `PK_ResultadoEvaluacion_IdResultado` (PRIMARY KEY)
- `IX_ResultadoEval_Evaluacion` (FOREIGN KEY)
- `IX_ResultadoEval_Usuario` (FOREIGN KEY)
- `IX_ResultadoEval_Fecha` (para reportes)

---

### 10. **Instituto_HistorialProgreso** ๐ NUEVA

**Descripciรณn:** Auditorรญa de cambios de estado en progreso de mรณdulos.

| Atributo | Tipo | Restricciรณn | Descripciรณn |
|----------|------|-------------|-------------|
| **IdHistorial** | INT | PK, IDENTITY(1,1) | ID รบnico de historial |
| IdInscripcion | INT | FK, NOT NULL | Referencia a progreso |
| EstatusAnterior | VARCHAR(50) | NOT NULL | Estado previo |
| EstatusNuevo | VARCHAR(50) | NOT NULL | Nuevo estado |
| FechaCambio | DATETIME | DEFAULT GETDATE() | Cuรกndo cambiรณ |
| UsuarioSistema | VARCHAR(50) | DEFAULT 'Sistema' | Quiรฉn realizรณ el cambio |
| Comentarios | VARCHAR(500) | NULL | Comentarios adicionales |

**รndices:**
- `PK_HistorialProgreso_IdHistorial` (PRIMARY KEY)
- `IX_HistorialProgreso_Inscripcion` (FOREIGN KEY)
- `IX_HistorialProgreso_Fecha` (para auditorรญas)

---

### 11. **Instituto_ReporteGerencial** ๐ NUEVA

**Descripciรณn:** Registro de reportes generados por el sistema.

| Atributo | Tipo | Restricciรณn | Descripciรณn |
|----------|------|-------------|-------------|
| **IdReporte** | INT | PK, IDENTITY(1,1) | ID รบnico del reporte |
| TipoReporte | VARCHAR(100) | NOT NULL | Tipo: Semanal TNG, Mรณdulos Crรญticos, etc. |
| NombreReporte | VARCHAR(300) | NOT NULL | Nombre del reporte generado |
| UsuarioGenerador | VARCHAR(50) | FK, NULL | Usuario que lo generรณ |
| FechaGeneracion | DATETIME | DEFAULT GETDATE() | Cuรกndo se generรณ |
| FechaInicio | DATE | NOT NULL | Perรญodo de inicio |
| FechaFin | DATE | NOT NULL | Perรญodo de fin |
| Parametros | TEXT | NULL | Parรกmetros usados (JSON) |
| ArchivoPDF | VARCHAR(500) | NULL | Ruta del archivo PDF |

**Tipos de reporte:**
- Resumen Semanal TNG
- Reporte de Mรณdulos Crรญticos
- Historial de Reportes
- Reporte por Departamento

**รndices:**
- `PK_ReporteGerencial_IdReporte` (PRIMARY KEY)
- `IX_ReporteGerencial_Usuario` (FOREIGN KEY)
- `IX_ReporteGerencial_Fecha` (para bรบsquedas por fecha)
- `IX_ReporteGerencial_Tipo` (para filtrar por tipo)

---

### 12. **Instituto_AuditoriaAcceso** ๐ NUEVA

**Descripciรณn:** Auditorรญa de accesos y acciones de usuarios en el sistema.

| Atributo | Tipo | Restricciรณn | Descripciรณn |
|----------|------|-------------|-------------|
| **IdAuditoria** | INT | PK, IDENTITY(1,1) | ID รบnico de auditorรญa |
| UserId | VARCHAR(50) | FK, NULL | Usuario que realizรณ la acciรณn |
| Accion | VARCHAR(200) | NOT NULL | Acciรณn realizada (Login, Ver Dashboard, etc.) |
| Modulo | VARCHAR(100) | NULL | Mรณdulo del sistema accedido |
| DireccionIP | VARCHAR(50) | NULL | IP desde donde se accediรณ |
| FechaHora | DATETIME | DEFAULT GETDATE() | Fecha y hora de la acciรณn |
| Exito | BIT | NOT NULL, DEFAULT 1 | Si la acciรณn fue exitosa |
| DetallesAdicionales | TEXT | NULL | Detalles en JSON |

**รndices:**
- `PK_AuditoriaAcceso_IdAuditoria` (PRIMARY KEY)
- `IX_AuditoriaAcceso_Usuario` (FOREIGN KEY)
- `IX_AuditoriaAcceso_Fecha` (para reportes de auditorรญa)
- `IX_AuditoriaAcceso_Accion` (para filtrar por acciรณn)

---

## RELACIONES Y CARDINALIDADES

### Relaciones Existentes (IMPLEMENTADAS)

| Relaciรณn | Entidad 1 | Cardinalidad | Entidad 2 | Descripciรณn |
|----------|-----------|--------------|-----------|-------------|
| R1 | Usuario | N | UnidadDeNegocio | Un usuario pertenece a una unidad |
| R2 | Usuario | N | ProgresoModulo | Un usuario tiene muchos progresos |
| R3 | Modulo | N | ProgresoModulo | Un mรณdulo tiene muchas inscripciones |

### Relaciones Nuevas (A IMPLEMENTAR)

| Relaciรณn | Entidad 1 | Cardinalidad | Entidad 2 | Descripciรณn |
|----------|-----------|--------------|-----------|-------------|
| R4 | Usuario | N | Rol | Un usuario tiene un rol |
| R5 | UnidadDeNegocio | N | Departamento | Una unidad puede estar asociada a un departamento TNG |
| R6 | Modulo | N:M | Departamento | Mรณdulos obligatorios por departamento |
| R7 | Modulo | 1:N | Evaluacion | Un mรณdulo tiene varias evaluaciones |
| R8 | Evaluacion | 1:N | ResultadoEvaluacion | Una evaluaciรณn tiene muchos resultados |
| R9 | Usuario | 1:N | ResultadoEvaluacion | Un usuario tiene muchos resultados de evaluaciones |
| R10 | ProgresoModulo | 1:N | HistorialProgreso | Cada progreso tiene un historial de cambios |
| R11 | Usuario | 1:N | ReporteGerencial | Un usuario genera muchos reportes |
| R12 | Usuario | 1:N | AuditoriaAcceso | Un usuario tiene muchas acciones auditadas |

---

## SCRIPTS SQL DE CREACIรN

### Script para SQL Server

```sql
-- ==========================================================
-- SMART REPORTS - INSTITUTO HUTCHISON PORTS
-- Script de Creaciรณn de Base de Datos - SQL Server
-- ==========================================================

USE master;
GO

-- Crear base de datos si no existe
IF NOT EXISTS (SELECT name FROM sys.databases WHERE name = 'TNGCORE')
BEGIN
    CREATE DATABASE TNGCORE;
END
GO

USE TNGCORE;
GO

-- ==========================================================
-- TABLA 1: Instituto_Rol (NUEVA)
-- ==========================================================
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Instituto_Rol]') AND type in (N'U'))
BEGIN
    CREATE TABLE [dbo].[Instituto_Rol] (
        [IdRol] INT IDENTITY(1,1) NOT NULL,
        [NombreRol] VARCHAR(100) NOT NULL,
        [Descripcion] VARCHAR(500) NULL,
        [NivelAcceso] INT NOT NULL DEFAULT 1,
        [Activo] BIT NOT NULL DEFAULT 1,
        CONSTRAINT [PK_Rol_IdRol] PRIMARY KEY CLUSTERED ([IdRol] ASC),
        CONSTRAINT [UQ_Rol_Nombre] UNIQUE ([NombreRol])
    );
END
GO

-- ==========================================================
-- TABLA 2: Instituto_Departamento (NUEVA)
-- ==========================================================
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Instituto_Departamento]') AND type in (N'U'))
BEGIN
    CREATE TABLE [dbo].[Instituto_Departamento] (
        [IdDepartamento] INT IDENTITY(1,1) NOT NULL,
        [NombreDepartamento] VARCHAR(200) NOT NULL,
        [TipoDepartamento] VARCHAR(50) NOT NULL DEFAULT 'TNG',
        [TasaFinalizacion] DECIMAL(5,2) NULL,
        [Activo] BIT NOT NULL DEFAULT 1,
        CONSTRAINT [PK_Departamento_IdDepartamento] PRIMARY KEY CLUSTERED ([IdDepartamento] ASC),
        CONSTRAINT [UQ_Departamento_Nombre] UNIQUE ([NombreDepartamento])
    );
END
GO

-- ==========================================================
-- TABLA 3: Instituto_UnidadDeNegocio (MODIFICADA)
-- ==========================================================
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Instituto_UnidadDeNegocio]') AND type in (N'U'))
BEGIN
    CREATE TABLE [dbo].[Instituto_UnidadDeNegocio] (
        [IdUnidadDeNegocio] INT IDENTITY(1,1) NOT NULL,
        [NombreUnidad] VARCHAR(200) NOT NULL,
        [Descripcion] TEXT NULL,
        [IdDepartamento] INT NULL,
        [Activo] BIT NOT NULL DEFAULT 1,
        CONSTRAINT [PK_UnidadDeNegocio_IdUnidad] PRIMARY KEY CLUSTERED ([IdUnidadDeNegocio] ASC),
        CONSTRAINT [UQ_UnidadDeNegocio_Nombre] UNIQUE ([NombreUnidad]),
        CONSTRAINT [FK_UnidadDeNegocio_Departamento] FOREIGN KEY ([IdDepartamento])
            REFERENCES [dbo].[Instituto_Departamento]([IdDepartamento])
            ON DELETE SET NULL
    );
END
GO

-- ==========================================================
-- TABLA 4: Instituto_Usuario (MODIFICADA)
-- ==========================================================
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Instituto_Usuario]') AND type in (N'U'))
BEGIN
    CREATE TABLE [dbo].[Instituto_Usuario] (
        [UserId] VARCHAR(50) NOT NULL,
        [Nombre] VARCHAR(200) NOT NULL,
        [Email] VARCHAR(150) NOT NULL,
        [TipoDeCorreo] VARCHAR(50) NOT NULL DEFAULT 'Corporativo',
        [IdUnidadDeNegocio] INT NULL,
        [IdRol] INT NOT NULL DEFAULT 1,
        [Division] VARCHAR(100) NULL,
        [Nivel] VARCHAR(100) NULL,
        [Activo] BIT NOT NULL DEFAULT 1,
        [FechaCreacion] DATETIME NOT NULL DEFAULT GETDATE(),
        [UltimaConexion] DATETIME NULL,
        CONSTRAINT [PK_Usuario_UserId] PRIMARY KEY CLUSTERED ([UserId] ASC),
        CONSTRAINT [UQ_Usuario_Email] UNIQUE ([Email]),
        CONSTRAINT [FK_Usuario_UnidadDeNegocio] FOREIGN KEY ([IdUnidadDeNegocio])
            REFERENCES [dbo].[Instituto_UnidadDeNegocio]([IdUnidadDeNegocio])
            ON DELETE SET NULL,
        CONSTRAINT [FK_Usuario_Rol] FOREIGN KEY ([IdRol])
            REFERENCES [dbo].[Instituto_Rol]([IdRol])
            ON DELETE SET DEFAULT
    );

    CREATE NONCLUSTERED INDEX [IX_Usuario_UnidadNegocio] ON [dbo].[Instituto_Usuario]([IdUnidadDeNegocio]);
    CREATE NONCLUSTERED INDEX [IX_Usuario_Activo] ON [dbo].[Instituto_Usuario]([Activo]);
    CREATE NONCLUSTERED INDEX [IX_Usuario_Rol] ON [dbo].[Instituto_Usuario]([IdRol]);
END
GO

-- ==========================================================
-- TABLA 5: Instituto_Modulo (MODIFICADA)
-- ==========================================================
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Instituto_Modulo]') AND type in (N'U'))
BEGIN
    CREATE TABLE [dbo].[Instituto_Modulo] (
        [IdModulo] INT IDENTITY(1,1) NOT NULL,
        [NombreModulo] VARCHAR(300) NOT NULL,
        [Descripcion] TEXT NULL,
        [Duracion] INT NULL,
        [FechaDeAsignacion] DATETIME NOT NULL DEFAULT GETDATE(),
        [Activo] BIT NOT NULL DEFAULT 1,
        [EsCritico] BIT NOT NULL DEFAULT 0,
        CONSTRAINT [PK_Modulo_IdModulo] PRIMARY KEY CLUSTERED ([IdModulo] ASC)
    );

    CREATE NONCLUSTERED INDEX [IX_Modulo_Activo] ON [dbo].[Instituto_Modulo]([Activo]);
END
GO

-- ==========================================================
-- TABLA 6: Instituto_ProgresoModulo (MODIFICADA)
-- ==========================================================
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Instituto_ProgresoModulo]') AND type in (N'U'))
BEGIN
    CREATE TABLE [dbo].[Instituto_ProgresoModulo] (
        [IdInscripcion] INT IDENTITY(1,1) NOT NULL,
        [UserId] VARCHAR(50) NOT NULL,
        [IdModulo] INT NOT NULL,
        [EstatusModuloUsuario] VARCHAR(50) NOT NULL DEFAULT 'Registrado',
        [CalificacionModuloUsuario] DECIMAL(5,2) NULL,
        [FechaInicio] DATE NULL,
        [FechaFinalizacion] DATETIME NULL,
        [FechaUltimaActualizacion] DATETIME NOT NULL DEFAULT GETDATE(),
        [IntentosRealizados] INT NOT NULL DEFAULT 0,
        CONSTRAINT [PK_ProgresoModulo_IdInscripcion] PRIMARY KEY CLUSTERED ([IdInscripcion] ASC),
        CONSTRAINT [UQ_ProgresoModulo_Usuario_Modulo] UNIQUE ([UserId], [IdModulo]),
        CONSTRAINT [FK_ProgresoModulo_Usuario] FOREIGN KEY ([UserId])
            REFERENCES [dbo].[Instituto_Usuario]([UserId])
            ON DELETE CASCADE,
        CONSTRAINT [FK_ProgresoModulo_Modulo] FOREIGN KEY ([IdModulo])
            REFERENCES [dbo].[Instituto_Modulo]([IdModulo])
            ON DELETE CASCADE,
        CONSTRAINT [CHECK_EstatusModulo] CHECK ([EstatusModuloUsuario] IN ('Completado', 'En proceso', 'Registrado', 'No iniciado')),
        CONSTRAINT [CHECK_Calificacion] CHECK ([CalificacionModuloUsuario] >= 0 AND [CalificacionModuloUsuario] <= 100)
    );

    CREATE NONCLUSTERED INDEX [IX_ProgresoModulo_UserId] ON [dbo].[Instituto_ProgresoModulo]([UserId]);
    CREATE NONCLUSTERED INDEX [IX_ProgresoModulo_IdModulo] ON [dbo].[Instituto_ProgresoModulo]([IdModulo]);
    CREATE NONCLUSTERED INDEX [IX_ProgresoModulo_Estatus] ON [dbo].[Instituto_ProgresoModulo]([EstatusModuloUsuario]);
    CREATE NONCLUSTERED INDEX [IX_ProgresoModulo_FechaFinalizacion] ON [dbo].[Instituto_ProgresoModulo]([FechaFinalizacion]);
END
GO

-- ==========================================================
-- TABLA 7: Instituto_ModuloDepartamento (NUEVA)
-- ==========================================================
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Instituto_ModuloDepartamento]') AND type in (N'U'))
BEGIN
    CREATE TABLE [dbo].[Instituto_ModuloDepartamento] (
        [IdModuloDepartamento] INT IDENTITY(1,1) NOT NULL,
        [IdModulo] INT NOT NULL,
        [IdDepartamento] INT NOT NULL,
        [Obligatorio] BIT NOT NULL DEFAULT 1,
        [FechaAsignacion] DATETIME NOT NULL DEFAULT GETDATE(),
        CONSTRAINT [PK_ModuloDepartamento_Id] PRIMARY KEY CLUSTERED ([IdModuloDepartamento] ASC),
        CONSTRAINT [UQ_ModuloDepartamento] UNIQUE ([IdModulo], [IdDepartamento]),
        CONSTRAINT [FK_ModuloDepartamento_Modulo] FOREIGN KEY ([IdModulo])
            REFERENCES [dbo].[Instituto_Modulo]([IdModulo])
            ON DELETE CASCADE,
        CONSTRAINT [FK_ModuloDepartamento_Departamento] FOREIGN KEY ([IdDepartamento])
            REFERENCES [dbo].[Instituto_Departamento]([IdDepartamento])
            ON DELETE CASCADE
    );

    CREATE NONCLUSTERED INDEX [IX_ModuloDepartamento_Modulo] ON [dbo].[Instituto_ModuloDepartamento]([IdModulo]);
    CREATE NONCLUSTERED INDEX [IX_ModuloDepartamento_Departamento] ON [dbo].[Instituto_ModuloDepartamento]([IdDepartamento]);
END
GO

-- ==========================================================
-- TABLA 8: Instituto_Evaluacion (NUEVA)
-- ==========================================================
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Instituto_Evaluacion]') AND type in (N'U'))
BEGIN
    CREATE TABLE [dbo].[Instituto_Evaluacion] (
        [IdEvaluacion] INT IDENTITY(1,1) NOT NULL,
        [IdModulo] INT NOT NULL,
        [TipoEvaluacion] VARCHAR(50) NOT NULL,
        [PuntajeMinimo] DECIMAL(5,2) NOT NULL DEFAULT 70.00,
        [NumeroPreguntas] INT NULL,
        [Activo] BIT NOT NULL DEFAULT 1,
        CONSTRAINT [PK_Evaluacion_IdEvaluacion] PRIMARY KEY CLUSTERED ([IdEvaluacion] ASC),
        CONSTRAINT [FK_Evaluacion_Modulo] FOREIGN KEY ([IdModulo])
            REFERENCES [dbo].[Instituto_Modulo]([IdModulo])
            ON DELETE CASCADE
    );

    CREATE NONCLUSTERED INDEX [IX_Evaluacion_IdModulo] ON [dbo].[Instituto_Evaluacion]([IdModulo]);
END
GO

-- ==========================================================
-- TABLA 9: Instituto_ResultadoEvaluacion (NUEVA)
-- ==========================================================
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Instituto_ResultadoEvaluacion]') AND type in (N'U'))
BEGIN
    CREATE TABLE [dbo].[Instituto_ResultadoEvaluacion] (
        [IdResultado] INT IDENTITY(1,1) NOT NULL,
        [IdEvaluacion] INT NOT NULL,
        [UserId] VARCHAR(50) NOT NULL,
        [Puntaje] DECIMAL(5,2) NOT NULL,
        [Aprobado] BIT NOT NULL,
        [FechaRealizacion] DATETIME NOT NULL DEFAULT GETDATE(),
        [NumeroIntento] INT NOT NULL DEFAULT 1,
        CONSTRAINT [PK_ResultadoEvaluacion_IdResultado] PRIMARY KEY CLUSTERED ([IdResultado] ASC),
        CONSTRAINT [FK_ResultadoEval_Evaluacion] FOREIGN KEY ([IdEvaluacion])
            REFERENCES [dbo].[Instituto_Evaluacion]([IdEvaluacion])
            ON DELETE CASCADE,
        CONSTRAINT [FK_ResultadoEval_Usuario] FOREIGN KEY ([UserId])
            REFERENCES [dbo].[Instituto_Usuario]([UserId])
            ON DELETE CASCADE,
        CONSTRAINT [CHECK_Puntaje] CHECK ([Puntaje] >= 0 AND [Puntaje] <= 100)
    );

    CREATE NONCLUSTERED INDEX [IX_ResultadoEval_Evaluacion] ON [dbo].[Instituto_ResultadoEvaluacion]([IdEvaluacion]);
    CREATE NONCLUSTERED INDEX [IX_ResultadoEval_Usuario] ON [dbo].[Instituto_ResultadoEvaluacion]([UserId]);
    CREATE NONCLUSTERED INDEX [IX_ResultadoEval_Fecha] ON [dbo].[Instituto_ResultadoEvaluacion]([FechaRealizacion]);
END
GO

-- ==========================================================
-- TABLA 10: Instituto_HistorialProgreso (NUEVA)
-- ==========================================================
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Instituto_HistorialProgreso]') AND type in (N'U'))
BEGIN
    CREATE TABLE [dbo].[Instituto_HistorialProgreso] (
        [IdHistorial] INT IDENTITY(1,1) NOT NULL,
        [IdInscripcion] INT NOT NULL,
        [EstatusAnterior] VARCHAR(50) NOT NULL,
        [EstatusNuevo] VARCHAR(50) NOT NULL,
        [FechaCambio] DATETIME NOT NULL DEFAULT GETDATE(),
        [UsuarioSistema] VARCHAR(50) NOT NULL DEFAULT 'Sistema',
        [Comentarios] VARCHAR(500) NULL,
        CONSTRAINT [PK_HistorialProgreso_IdHistorial] PRIMARY KEY CLUSTERED ([IdHistorial] ASC),
        CONSTRAINT [FK_HistorialProgreso_Inscripcion] FOREIGN KEY ([IdInscripcion])
            REFERENCES [dbo].[Instituto_ProgresoModulo]([IdInscripcion])
            ON DELETE CASCADE
    );

    CREATE NONCLUSTERED INDEX [IX_HistorialProgreso_Inscripcion] ON [dbo].[Instituto_HistorialProgreso]([IdInscripcion]);
    CREATE NONCLUSTERED INDEX [IX_HistorialProgreso_Fecha] ON [dbo].[Instituto_HistorialProgreso]([FechaCambio]);
END
GO

-- ==========================================================
-- TABLA 11: Instituto_ReporteGerencial (NUEVA)
-- ==========================================================
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Instituto_ReporteGerencial]') AND type in (N'U'))
BEGIN
    CREATE TABLE [dbo].[Instituto_ReporteGerencial] (
        [IdReporte] INT IDENTITY(1,1) NOT NULL,
        [TipoReporte] VARCHAR(100) NOT NULL,
        [NombreReporte] VARCHAR(300) NOT NULL,
        [UsuarioGenerador] VARCHAR(50) NULL,
        [FechaGeneracion] DATETIME NOT NULL DEFAULT GETDATE(),
        [FechaInicio] DATE NOT NULL,
        [FechaFin] DATE NOT NULL,
        [Parametros] TEXT NULL,
        [ArchivoPDF] VARCHAR(500) NULL,
        CONSTRAINT [PK_ReporteGerencial_IdReporte] PRIMARY KEY CLUSTERED ([IdReporte] ASC),
        CONSTRAINT [FK_ReporteGerencial_Usuario] FOREIGN KEY ([UsuarioGenerador])
            REFERENCES [dbo].[Instituto_Usuario]([UserId])
            ON DELETE SET NULL
    );

    CREATE NONCLUSTERED INDEX [IX_ReporteGerencial_Usuario] ON [dbo].[Instituto_ReporteGerencial]([UsuarioGenerador]);
    CREATE NONCLUSTERED INDEX [IX_ReporteGerencial_Fecha] ON [dbo].[Instituto_ReporteGerencial]([FechaGeneracion]);
    CREATE NONCLUSTERED INDEX [IX_ReporteGerencial_Tipo] ON [dbo].[Instituto_ReporteGerencial]([TipoReporte]);
END
GO

-- ==========================================================
-- TABLA 12: Instituto_AuditoriaAcceso (NUEVA)
-- ==========================================================
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[Instituto_AuditoriaAcceso]') AND type in (N'U'))
BEGIN
    CREATE TABLE [dbo].[Instituto_AuditoriaAcceso] (
        [IdAuditoria] INT IDENTITY(1,1) NOT NULL,
        [UserId] VARCHAR(50) NULL,
        [Accion] VARCHAR(200) NOT NULL,
        [Modulo] VARCHAR(100) NULL,
        [DireccionIP] VARCHAR(50) NULL,
        [FechaHora] DATETIME NOT NULL DEFAULT GETDATE(),
        [Exito] BIT NOT NULL DEFAULT 1,
        [DetallesAdicionales] TEXT NULL,
        CONSTRAINT [PK_AuditoriaAcceso_IdAuditoria] PRIMARY KEY CLUSTERED ([IdAuditoria] ASC),
        CONSTRAINT [FK_AuditoriaAcceso_Usuario] FOREIGN KEY ([UserId])
            REFERENCES [dbo].[Instituto_Usuario]([UserId])
            ON DELETE SET NULL
    );

    CREATE NONCLUSTERED INDEX [IX_AuditoriaAcceso_Usuario] ON [dbo].[Instituto_AuditoriaAcceso]([UserId]);
    CREATE NONCLUSTERED INDEX [IX_AuditoriaAcceso_Fecha] ON [dbo].[Instituto_AuditoriaAcceso]([FechaHora]);
    CREATE NONCLUSTERED INDEX [IX_AuditoriaAcceso_Accion] ON [dbo].[Instituto_AuditoriaAcceso]([Accion]);
END
GO

-- ==========================================================
-- DATOS INICIALES
-- ==========================================================

-- Insertar roles por defecto
IF NOT EXISTS (SELECT 1 FROM Instituto_Rol WHERE IdRol = 1)
BEGIN
    INSERT INTO Instituto_Rol (NombreRol, Descripcion, NivelAcceso, Activo) VALUES
    ('Usuario Estรกndar', 'Usuario con acceso bรกsico al sistema', 1, 1),
    ('Supervisor', 'Supervisor de equipo con acceso a reportes de su unidad', 2, 1),
    ('Jefe de Departamento', 'Jefe con acceso a datos de su departamento', 3, 1),
    ('Gerente TNG', 'Gerente con acceso completo a datos TNG', 4, 1),
    ('Administrador', 'Acceso completo al sistema', 5, 1);
END
GO

-- Insertar departamentos TNG
IF NOT EXISTS (SELECT 1 FROM Instituto_Departamento WHERE IdDepartamento = 1)
BEGIN
    INSERT INTO Instituto_Departamento (NombreDepartamento, TipoDepartamento, TasaFinalizacion, Activo) VALUES
    ('Operaciones TNG', 'TNG', 87.00, 1),
    ('Logรญstica TNG', 'TNG', 73.00, 1),
    ('Mantenimiento TNG', 'TNG', 92.00, 1),
    ('Seguridad TNG', 'TNG', 65.00, 1);
END
GO

PRINT 'Base de datos TNGCORE creada exitosamente para SQL Server';
GO
```

---

## CONSIDERACIONES TรCNICAS

### 1. **Integridad Referencial**
- Todas las relaciones FK con `ON DELETE CASCADE` donde corresponde
- `ON DELETE SET NULL` para referencias opcionales
- `ON DELETE SET DEFAULT` para usuario-rol (mantiene rol estรกndar)

### 2. **รndices**
- PRIMARY KEY en todas las tablas
- UNIQUE donde aplica (emails, combinaciones usuario-mรณdulo)
- INDEX en todas las FKs para optimizar joins
- INDEX en campos de fecha para reportes

### 3. **Constraints**
- CHECK para validar rangos (calificaciones 0-100)
- CHECK para validar estados permitidos
- UNIQUE para evitar duplicados
- DEFAULT para campos comunes

### 4. **Campos de Auditorรญa**
- `FechaCreacion` en Usuario
- `FechaUltimaActualizacion` en ProgresoModulo
- `FechaGeneracion` en Reportes
- `FechaHora` en Auditorรญa

### 5. **Compatibilidad MySQL**
- Cambiar `BIT` por `TINYINT(1)`
- Cambiar `IDENTITY(1,1)` por `AUTO_INCREMENT`
- Cambiar `GETDATE()` por `NOW()` o `CURRENT_TIMESTAMP`
- Cambiar `TEXT` por `TEXT` o `LONGTEXT`
- Usar backticks `` en lugar de corchetes `[]`

---

## QUERIES รTILES

### Verificar progreso de un usuario
```sql
SELECT
    u.Nombre,
    m.NombreModulo,
    pm.EstatusModuloUsuario,
    pm.CalificacionModuloUsuario,
    pm.FechaFinalizacion
FROM Instituto_Usuario u
INNER JOIN Instituto_ProgresoModulo pm ON u.UserId = pm.UserId
INNER JOIN Instituto_Modulo m ON pm.IdModulo = m.IdModulo
WHERE u.UserId = 'U12345'
ORDER BY pm.FechaFinalizacion DESC;
```

### Obtener estadรญsticas TNG por departamento
```sql
SELECT
    d.NombreDepartamento,
    COUNT(DISTINCT u.UserId) AS TotalEmpleados,
    COUNT(DISTINCT CASE WHEN pm.EstatusModuloUsuario = 'Completado' THEN pm.IdInscripcion END) AS ModulosCompletados,
    AVG(CASE WHEN pm.CalificacionModuloUsuario IS NOT NULL THEN pm.CalificacionModuloUsuario END) AS PromedioCalificacion
FROM Instituto_Departamento d
LEFT JOIN Instituto_UnidadDeNegocio un ON d.IdDepartamento = un.IdDepartamento
LEFT JOIN Instituto_Usuario u ON un.IdUnidadDeNegocio = u.IdUnidadDeNegocio
LEFT JOIN Instituto_ProgresoModulo pm ON u.UserId = pm.UserId
WHERE d.TipoDepartamento = 'TNG'
GROUP BY d.IdDepartamento, d.NombreDepartamento;
```

### Mรณdulos crรญticos pendientes
```sql
SELECT
    u.UserId,
    u.Nombre,
    m.NombreModulo,
    pm.EstatusModuloUsuario
FROM Instituto_Usuario u
CROSS JOIN Instituto_Modulo m
LEFT JOIN Instituto_ProgresoModulo pm ON u.UserId = pm.UserId AND m.IdModulo = pm.IdModulo
WHERE m.EsCritico = 1
AND (pm.EstatusModuloUsuario IS NULL OR pm.EstatusModuloUsuario != 'Completado')
AND u.Activo = 1
ORDER BY u.Nombre, m.NombreModulo;
```

---

## PRรXIMOS PASOS

### Fase 1: Creaciรณn de tablas nuevas โ
1. Ejecutar script de creaciรณn en base de datos
2. Verificar que todas las tablas se crearon correctamente
3. Poblar datos iniciales (roles, departamentos TNG)

### Fase 2: Migraciรณn de cรณdigo Python
1. Actualizar `database/queries.py` con nuevas queries
2. Crear clases para nuevas entidades en `services/`
3. Actualizar paneles para usar nuevas tablas

### Fase 3: Implementar funcionalidades TNG
1. Conectar TNG Summary Panel con tabla Departamento
2. Implementar generaciรณn de reportes gerenciales
3. Guardar reportes en tabla ReporteGerencial

### Fase 4: Sistema de Roles y Login
1. Validar credenciales contra tabla Usuario
2. Implementar control de acceso por rol
3. Registrar acciones en AuditoriaAcceso

### Fase 5: Auditorรญa completa
1. Triggers para HistorialProgreso
2. Logs automรกticos de cambios
3. Dashboard de auditorรญa para administradores

---

## CONCLUSIรN

Este modelo entidad-relaciรณn definitivo proporciona:

โ **Solidez:** Todas las relaciones con integridad referencial
โ **Escalabilidad:** Preparado para crecimiento futuro
โ **Auditorรญa:** Trazabilidad completa de cambios
โ **Seguridad:** Control de acceso por roles
โ **Funcionalidad TNG:** Soporte completo para departamentos y reportes
โ **Compatibilidad:** Scripts para SQL Server y MySQL

**NO habrรก errores** si se implementa este modelo completo, ya que:
- Todas las FKs estรกn definidas correctamente
- Todos los campos obligatorios tienen valores por defecto o NOT NULL
- Todas las restricciones CHECK previenen datos invรกlidos
- Todos los รญndices optimizan las consultas frecuentes
- Todas las entidades estรกn normalizadas (3FN)

---

**Documento generado:** 2025-10-28
**Versiรณn:** 1.0 - Definitiva
**Estado:** โ Listo para implementaciรณn
